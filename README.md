# 🤖 YandexGPT Multi-Agent Telegram Bot

Мультиагентный Telegram бот на базе `pyautogen` и Yandex Cloud LLM. Бот использует команду из 5 агентов для решения задач пользователя с полной прозрачностью процесса.

## 🌟 Особенности

- **👥 Прозрачный диалог агентов**: Пользователь видит все шаги решения задачи
- **💻 Выполнение кода**: Безопасное выполнение Python кода в изолированной среде
- **🧠 Команда экспертов**:
  - 👤 **User Proxy** - Прием задач от пользователя
  - 🧠 **Analyst** - Анализ задачи и планирование решения
  - 👨‍💻 **Coder** - Написание Python кода
  - ⚙️ **Executor** - Безопасное выполнение кода
  - 🤖 **Manager** - Координация работы команды
- **☁️ Yandex Cloud Integration**: Использование YandexGPT через официальный API
- **🔒 Безопасность**: Изоляция выполнения кода, защита от инъекций

## 🚀 Быстрый старт

### 1. Подготовка

```bash
# Клонировать репозиторий
git clone https://github.com/Vladimir-1909/autogen_telegram_bot
cd autogen-telegram-bot

# Создать .env файл из примера
cp .env.example .env

# Заполнить необходимые параметры в .env:
# - TELEGRAM_TOKEN (получить у @BotFather)
# - YANDEX_API_KEY (Yandex Cloud Console)
# - YANDEX_FOLDER_ID (Yandex Cloud Console)
```

### 2. Запуск с Docker

```bash
# Собрать и запустить контейнеры
docker-compose up -d --build

# Проверить статус
docker-compose ps

# Посмотреть логи
docker-compose logs -f agent_bot
```

### 3. Использование

- Отправьте `/start` для приветственного сообщения
- Напишите задачу: "Покажи график курса доллара за последние 7 дней"
- Наблюдайте за работой агентов в реальном времени
- Используйте `/reset` для очистки контекста диалога

## 🏗 Архитектура

```
┌─────────────┐    ┌─────────────────────────────────────────────────────┐
│   Telegram  │    │                    Application                      │
│    User     │───▶│                                                     │
└─────────────┘    │  ┌─────────────┐    ┌─────────────────────────────┐ │
                   │  │  Handlers   │───▶│    Session Manager          │ │
                   │  └─────────────┘    └─────────────────────────────  │
                   │                          │                          │
                   │                          ▼                          │
                   │  ┌───────────────────────────────────────────────┐  │
                   │  │              Agent System                     │  │
                   │  │                                               │  │
                   │  │  ┌───────────┐  ┌───────────┐  ┌────────────┐ │  │
                   │  │  │ UserProxy │  │ Analyst   │  │ Coder      │ │  │
                   │  │  └───────────┘  └───────────┘  └────────────┘ │  │
                   │  │       │              │              │         │  │
                   │  │       ▼              ▼              ▼         │  │
                   │  │  ┌─────────────────────────────────────────┐  │  │
                   │  │  │            Group Chat Manager           │  │  │
                   │  │  └─────────────────────────────────────────┘  │  │
                   │  └───────────────────────────────────────────────┘  │
                   └─────────────────────────────────────────────────────┘
```

## 🔒 Безопасность

1. **Изоляция выполнения кода**:
   - Код выполняется в отдельной директории `/app/workspace`
   - Запрещено использование опасных модулей (`os`, `sys`, `subprocess`)
   - Ограничение времени выполнения

2. **Защита конфиденциальных данных**:
   - API ключи хранятся в `.env` (исключен из git)
   - Нет сохранения персональных данных пользователей
   - Шифрование сетевого трафика

3. **Защита от злоупотреблений**:
   - Ограничение количества сообщений в минуту
   - Белый список разрешенных чатов
   - Мониторинг подозрительной активности

## 🛠 Разработка

### Требования
- Python 3.11+
- Docker 24.0+
- Docker Compose v2+

### Установка для разработки
```bash
# Создать виртуальное окружение
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows

# Установить зависимости
pip install -r requirements.txt

# Установить dev-зависимости
pip install pylint black isort mypy pytest
```

### Линтинг и форматирование
```bash
# Запустить линтер
pylint src/

# Форматирование кода
black src/
isort src/

# Статическая типизация
mypy src/

# Запуск тестов
pytest tests/
```

### Структура проекта
```
├── src/                    # Исходный код
│   ├── bot/                # Telegram бот логика
│   │   ├── handlers.py     # Обработчики команд
│   │   └── interface.py    # Интерфейс с Telegram
│   ├── core/               # Ядро приложения
│   │   ├── agent_system.py # Система агентов
│   │   └── session_manager.py # Управление сессиями
│   ├── config.py           # Конфигурация
│   └── main.py             # Точка входа
├── tests/                  # Тесты
├── workspace/              # Рабочая директория (код)
├── logs/                   # Логи
├── cache/                  # Кэш
├── .env.example            # Пример конфигурации
├── docker-compose.yml      # Docker конфигурация
├── Dockerfile              # Сборка образа
├── requirements.txt        # Зависимости
└── README.md               # Документация
```

## 📜 Лицензия

Этот проект распространяется под лицензией MIT - подробности см. в файле [LICENSE](LICENSE).

## 🙏 Благодарности

- [Microsoft Autogen](https://github.com/microsoft/autogen) - фреймворк для мультиагентных систем
- [python-telegram-bot](https://github.com/python-telegram-bot/python-telegram-bot) - библиотека для работы с Telegram API
- [Yandex Cloud](https://cloud.yandex.ru/) - облачная платформа и LLM сервисы

---

**Версия**: 1.0.0  
**Последнее обновление**: 26 ноября 2025 г.


## 📋 requirements.txt
```
# Core dependencies
python-dotenv==1.2.1
python-telegram-bot==20.6
httpx==0.25.2
autogen-ext==0.7.5
autogen-agentchat==0.7.5
pyautogen==0.2.35
requests==2.32.5
```